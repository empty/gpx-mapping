<html>
<head>
    <title>Leaflet KML Example</title>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.ie.css" /><![endif]-->

    <!-- Bring in the leaflet KML plugin -->
    <script src="/static/js/Leaflet.PolylineMeasuredDistance.js"></script>
    <script src="/static/js/GPX.js"></script>

    <script language="javascript">
    function getRandomColor() {
        var letters = '0123456789ABCDEF'.split('');
        var color = '#';
        for (var i = 0; i < 6; i++ ) {
            color += letters[Math.round(Math.random() * 15)];
        }
        return color;
    }
    function init() {
        var map = new L.Map('map');

        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18,
            opacity: .2
        }).addTo(map);
        L.control.scale().addTo(map);
        map.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

        var tracks = new L.featureGroup();
        var layers = {};

        {% for file in files %}
        var track = new L.GPX("/static/gpx/{{ file }}", {async: false, weight: 2, color: getRandomColor() });
        tracks.addLayer(track);

        layers["{{ file[:10] }}"] = track;
        {% endfor %}

        L.control.layers(layers).addTo(map);

        map.addLayer(tracks);
        map.fitBounds(tracks.getBounds());
    }
    </script>
</head>
<body onLoad="javascript:init();">
    <div id="map" style="width: 100%; height: 100%;"></div>
</body>
</html>

